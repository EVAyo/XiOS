

# 推送原理

1.打开App时: 发送`UDID`和`BundleID`给`APNs`加密后返回`deviceToken`

2.获取`Token`后，App调用接口,将用户身份信息和`deviceToken`发给服务器，服务器记录

3.当推送消息时, 服务器按照用户身份信息找到存储的`deviceToken`，将消息和`deviToken`发送给`APNs`

4.苹果的APNs通过`deviceToken`, 找到指定设备的指定程序, 并将消息推送给用户







- iOS 7 出现的Silent remote notifications(远程静默推送)
- iOS 8 出现的Category(分类, 也可称之为快捷回复)
- iOS 9 出现的Text Input action(文本框快捷回复).

随着iOS10的到来 , 苹果对远程通知和本地通知进行了大范围的更新.
iOS10推出了全新的**UserNotifications**框架(iOS10之前从属于UIKit框架).



iOS 10之前，iOS推送只能实现文字消息。
iOS10之后，苹果官方新增了一些特性，其中包括新的推送方式----**推送拦截（Service Extension）**，这种推送方式允许iOS开发者对接收到的推送消息进行一定的处理，以便达到自己想要的效果。



# 推送消息扩展

https://www.jianshu.com/p/734998be68dc

https://www.jianshu.com/p/fd6d7906010d

https://www.jianshu.com/p/8c362a6dcc0e

- UNNotificationServiceExtension
- UNNotificationContentExtension







“mutable-content”: 1，代表自定义了推送 例如图片、视频、声音等
“content-available”:1，静默推送



```
{
    "aps":{
        "alert":{
            "title":"Push Title",
            "subtitle":"Push Subtitle",
            "body":"Push Body"
        },
        "sound":"default",
        "badge":1,
        "mutable-content":1
    },
    "landing_page":"https://www.baidu.com"
}
```

* 如果要支持扩展服务，一定要确保`payload`的`aps`字典中包含`mutable-content`字段，值为1。







# 模拟推送

> iOS 10 新增的 Notification Service Extension 功能，用 mutable-content 字段来控制。
> 若使用 Web 控制台，需勾选 “可选设置”中 mutable-content 选项；若使用 RESTFul API 需设置 mutable-content 字段为 true。





